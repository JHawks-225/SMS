<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Panel Admin Chat</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">

  <h1>Panel Admin ðŸ‘‘</h1>

  <div class="form-container">
    <h2>Demandes en attente</h2>
    <div id="list">
      </div>

    <button onclick="download()">TÃ©lÃ©charger l'historique</button>
  </div>

</div>

<script>
// On rÃ©cupÃ¨re le mot de passe directement dans l'URL (le ?pw=10009)
const urlParams = new URLSearchParams(window.location.search);
const adminPw = urlParams.get('pw');

function refresh() {
  if(!adminPw) return;

  // On ajoute le mot de passe Ã  la requÃªte fetch
  fetch(`/admin/demandes?pw=${adminPw}`)
    .then(r => r.json())
    .then(data => {
      const list = document.getElementById("list");
      list.innerHTML = "";
      data.forEach(u => {
        const vis = u.visibleNom ? "Oui" : "Non";
        list.innerHTML += `
        <div class="demande">
          <p><strong>${u.pseudo}</strong> (${u.nom || "â€”"}) - Visible publiquement: ${vis}
          <button onclick="valider('${u.pseudo}')">Valider</button></p>
        </div>`;
      });
    });
}

function valider(pseudo) {
  // On ajoute aussi le mot de passe ici pour avoir l'autorisation de valider
  fetch(`/admin/valider?pw=${adminPw}`, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({pseudo})
  }).then(refresh);
}

function download() {
  // Le tÃ©lÃ©chargement doit aussi Ãªtre autorisÃ©
  window.location = `/download?pw=${adminPw}`;
}

// RafraÃ®chissement automatique toutes les 2 secondes
setInterval(refresh, 2000);
refresh();
</script>

</body>
</html>