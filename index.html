<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Chat de Classe</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ===== INSCRIPTION ===== -->
<div class="container" id="register">
  <h1>ğŸ“ Inscription</h1>

  <input type="text" id="nom" placeholder="Nom rÃ©el">
  <input type="text" id="pseudo" placeholder="Pseudo">
  <input type="text" id="numero" placeholder="NumÃ©ro">

  <label>
    <input type="checkbox" id="visibleNom">
    Afficher mon vrai nom publiquement
  </label>

  <button onclick="inscription()">Envoyer la demande</button>
</div>

<!-- ===== EN ATTENTE ===== -->
<div class="container" id="waiting" style="display:none;">
  <h1>â³ Demande envoyÃ©e</h1>
  <p>En attente de validation par l'administrateurâ€¦</p>
</div>

<!-- ===== CHAT ===== -->
<div class="app" id="chat" style="display:none;">

  <aside class="sidebar">
    <h2>ğŸ’¬ Chat</h2>
    <button onclick="openGeneral()"># GÃ©nÃ©ral</button>
    <button onclick="openPrivate()">ğŸ‘¤ PrivÃ©</button>
    <button onclick="openGroup()">ğŸ‘¥ Groupe</button>

    <hr>
    <h3>Utilisateurs</h3>
    <ul id="users"></ul>
  </aside>

  <main class="chat">
    <header class="chat-header">
      <h2 id="chat-title">Discussion gÃ©nÃ©rale</h2>
    </header>

    <div class="messages" id="messages"></div>

    <div class="input-zone">
      <input type="text" id="messageInput" placeholder="Messageâ€¦">
      <button onclick="sendMessage()">Envoyer</button>
    </div>
  </main>

</div>

<script>
/* ===== ETAT UTILISATEUR ===== */
const status = localStorage.getItem("status");

if (status === "waiting") showWaiting();
if (status === "accepted") showChat();

/* ===== INSCRIPTION ===== */
function inscription() {
  const user = {
    nom: nom.value,
    pseudo: pseudo.value,
    numero: numero.value,
    visibleNom: visibleNom.checked
  };

  fetch("/register", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(user)
  });

  localStorage.setItem("status", "waiting");
  showWaiting();
}

function showWaiting() {
  register.style.display = "none";
  waiting.style.display = "block";
}

/* ===== CHAT ===== */
function showChat() {
  register.style.display = "none";
  waiting.style.display = "none";
  chat.style.display = "flex";
}

/* Simulation validation admin (temporaire) */
setInterval(() => {
  fetch("/status")
    .then(r => r.json())
    .then(r => {
      if (r.accepted) {
        localStorage.setItem("status", "accepted");
        showChat();
      }
    });
}, 3000);

/* ===== CHAT UI ===== */
function openGeneral() {
  chatTitle("Discussion gÃ©nÃ©rale");
}

function openPrivate() {
  chatTitle("Discussions privÃ©es");
}

function openGroup() {
  const g = prompt("Nom du groupe ?");
  if (g) alert("Groupe '" + g + "' crÃ©Ã©");
}

function chatTitle(t) {
  document.getElementById("chat-title").textContent = t;
  messages.innerHTML = "";
}

function sendMessage() {
  if (!messageInput.value) return;
  const d = document.createElement("div");
  d.className = "message me";
  d.textContent = messageInput.value;
  messages.appendChild(d);
  messageInput.value = "";
}

/* Faux users visuels */
["Alex","Sarah","Koffi"].forEach(u=>{
  const li=document.createElement("li");
  li.textContent=u;
  users.appendChild(li);
});
</script>

</body>
</html>
